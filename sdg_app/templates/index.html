<!doctype html>
<html lang="ja" data-theme="frutiger-aero">
<head>
  <meta charset="utf-8">
  <title>MABEL Studio â€” Visual Agent Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light">
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
  <header class="topbar glass">
    <div class="brand">
      <span class="logo-orb" aria-hidden="true"></span>
      <strong class="brand-title">MABEL Studio</strong>
      <span class="sub">Visual YAML Builder for AI Agents</span>
    </div>
    <div class="top-actions">
      <button id="btnClear" class="ghost">New</button>
      <button id="btnAutoLayout" class="accent" title="execé †ã§è‡ªå‹•æ•´åˆ—">Auto Layout</button>
      <button id="btnV2Settings" class="accent" title="v2è¨­å®šï¼ˆruntime, budgets, globalsç­‰ï¼‰">âš™ï¸ v2è¨­å®š</button>
      <details class="ghost-d">
        <summary>Help</summary>
        <div class="popover">
          <p><b>ã‚¯ã‚¤ãƒƒã‚¯ãƒ˜ãƒ«ãƒ—</b></p>
          <ul>
            <li>å³ã® <b>AI / LOGIC / CODE / END</b> ã‚’å·¦ã®ã‚­ãƒ£ãƒ³ãƒã‚¹ã¸ãƒ‰ãƒ©ãƒƒã‚°</li>
            <li>ãƒãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç·¨é›†ï¼ˆä»»æ„é …ç›®ã¯ <code><details></code> å†…ï¼‰</li>
            <li><b>Save</b> ã§è‡ªå‹•é…ç·šãƒ»è‡ªå‹•æ•´åˆ—</li>
            <li>ç§»å‹•: <span class="kbd">Space</span>+ãƒ‰ãƒ©ãƒƒã‚° ï¼ ã‚ºãƒ¼ãƒ : <span class="kbd">Ctrl/âŒ˜</span>+ãƒ›ã‚¤ãƒ¼ãƒ«</li>
            <li>YAML: <b>Generate</b> ã§ä¿å­˜ ï¼ <b>Import</b> ã§èª­è¾¼</li>
          </ul>
        </div>
      </details>
    </div>
  </header>

  <main class="split">
    <!-- å·¦ï¼šãƒãƒ¼ãƒ‰ã‚­ãƒ£ãƒ³ãƒã‚¹ -->
    <section id="canvas" class="canvas" tabindex="0" aria-label="Node canvas">
      <svg id="wires" class="wires" preserveAspectRatio="none" aria-hidden="true">
        <defs id="wire-defs">
          <!-- ãƒ©ã‚¤ãƒˆãƒ–ãƒ«ãƒ¼â†’ãƒ©ã‚¤ãƒ ã®é…ç·šã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ + å¾®ã‚°ãƒ­ãƒ¼ -->
          <linearGradient id="edgeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="var(--line-start)"></stop>
            <stop offset="100%" stop-color="var(--line-end)"></stop>
          </linearGradient>
          <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur stdDeviation="2.5" result="blur"></feGaussianBlur>
            <feMerge>
              <feMergeNode in="blur"></feMergeNode>
              <feMergeNode in="SourceGraphic"></feMergeNode>
            </feMerge>
          </filter>
          <!-- â˜… çŸ¢å°ã®ã‚µã‚¤ã‚ºã‚’ç·šå¹…åŸºæº–ã«ï¼ˆã‚ºãƒ¼ãƒ ã§ã‚‚è‡ªç„¶ï¼‰ -->
          <marker id="arrow" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse" markerUnits="strokeWidth">
            <path d="M 0 0 L 10 5 L 0 10 z" style="fill: var(--line-end);"></path>
          </marker>
        </defs>
      </svg>
      <div id="nodes" class="nodes"></div>
      <div class="canvas-hint" role="status" aria-live="polite">
        Drag or press <span class="kbd">Enter</span> to add â€¢ <span class="kbd">Space</span>+drag to pan â€¢ <span class="kbd">Ctrl/âŒ˜</span>+wheel to zoom
      </div>
      <!-- â˜… Zoom HUD ã¯JSã§æŒ¿å…¥ï¼ˆ.zoom-hudï¼‰ -->
    </section>

    <!-- å³ï¼šã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
    <aside class="sidebar glass" role="complementary" aria-label="è¨­å®šã‚µã‚¤ãƒ‰ãƒãƒ¼">
      <!-- ãƒ¢ãƒ‡ãƒ«è¨­å®šï¼ˆå³ä¸Šï¼‰ -->
      <section class="panel glass" id="modelsPanel" role="region" aria-labelledby="hdr-models">
        <div class="panel-head clickable">
          <h2 id="hdr-models">AIãƒ¢ãƒ‡ãƒ«è¨­å®š</h2>
          <button id="btnAddModel" class="accent" type="button">+ Add Model</button>
        </div>
        <div class="panel-tools">
          <button id="btnModelsSaveLocal" class="ghost" type="button" title="ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ï¼ˆãƒ–ãƒ­ãƒƒã‚¯ã¸ã¯å½±éŸ¿ã—ã¾ã›ã‚“ï¼‰">Save</button>
          <button id="btnModelsLoadLocal" class="ghost" type="button" title="ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰èª­è¾¼ï¼ˆãƒ–ãƒ­ãƒƒã‚¯ã¸ã¯å½±éŸ¿ã—ã¾ã›ã‚“ï¼‰">Load</button>
          <button id="btnModelsReset" class="ghost danger" type="button" title="æ—¢å®šã®ãƒ¢ãƒ‡ãƒ«è¨­å®šã«æˆ»ã™ï¼ˆãƒ–ãƒ­ãƒƒã‚¯ã¯ç¶­æŒï¼‰">Reset</button>
          <button id="btnModelsDownloadYAML" class="primary wide" type="button" title="ãƒ¢ãƒ‡ãƒ«è¨­å®šã®ã¿ã‚’YAMLä¿å­˜">Models YAML</button>
        </div>
        <div class="panel-note small-note">ãƒ¢ãƒ‡ãƒ«è¨­å®šã®ã¿ã®æ“ä½œã§ã™ï¼ˆãƒ–ãƒ­ãƒƒã‚¯ã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“ï¼‰ã€‚</div>
        <div id="modelsList" class="models-list">
          <!-- JSã§æŒ¿å…¥ -->
        </div>
      </section>

      <!-- ãƒ–ãƒ­ãƒƒã‚¯é…ç½®ï¼ˆå³ä¸‹ï¼‰ -->
      <section class="panel glass" id="libraryPanel" role="region" aria-labelledby="hdr-library">
        <div class="panel-head">
          <h2 id="hdr-library">ãƒ–ãƒ­ãƒƒã‚¯é…ç½®</h2>
        </div>
        <div class="library" id="library">
          <div class="lib-item" draggable="true" data-type="start" title="STARTãƒ–ãƒ­ãƒƒã‚¯ï¼ˆUserInputå‡ºåŠ›ã®ã¿ï¼‰" tabindex="0">
            <div class="lib-icon">â–¶ï¸</div>
            <div class="lib-name">START</div>
          </div>
          <div class="lib-item" draggable="true" data-type="ai" title="AIãƒ–ãƒ­ãƒƒã‚¯" tabindex="0">
            <div class="lib-icon">ğŸ¤–</div>
            <div class="lib-name">AI</div>
          </div>
          <div class="lib-item" draggable="true" data-type="logic" title="LOGICãƒ–ãƒ­ãƒƒã‚¯" tabindex="0">
            <div class="lib-icon">âˆ´</div>
            <div class="lib-name">LOGIC</div>
          </div>
          <div class="lib-item" draggable="true" data-type="python" title="CODEãƒ–ãƒ­ãƒƒã‚¯ï¼ˆtype: pythonï¼‰" tabindex="0">
            <div class="lib-icon">âŒ˜</div>
            <div class="lib-name">CODE</div>
          </div>
          <div class="lib-item" draggable="true" data-type="end" title="ENDãƒ–ãƒ­ãƒƒã‚¯ï¼ˆtype: endï¼‰" tabindex="0">
            <div class="lib-icon">ğŸ</div>
            <div class="lib-name">END</div>
          </div>
        </div>

        <div class="export">
          <div class="export-controls">
            <button id="btnGenerate" class="primary" type="button">YAML Generate</button>
            <button id="btnPreview" class="ghost" type="button">YAML Preview</button>
            <button id="btnImport" class="ghost" type="button">YAML Import</button>
            <input type="file" id="yamlFile" accept=".yaml,.yml,text/yaml" hidden>
          </div>
          <div id="importDrop" class="import-drop" aria-label="YAML dropzone">
            Drop .yaml/.yml here to import
          </div>
        </div>
      </section>
    </aside>
  </main>

  <!-- ãƒ–ãƒ­ãƒƒã‚¯ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <dialog id="editorModal" class="modal glass">
    <form method="dialog" id="editorForm">
      <header class="modal-head">
        <h3 id="editorTitle">Block Editor</h3>
        <!-- å¤‰æ›´: ãƒ–ãƒ­ãƒƒã‚¯ã®Ã—ã¨åŒæ„åŒ ã«ã™ã‚‹ãŸã‚ del ã‚’ä»˜ä¸ -->
        <button class="del icon-close" value="cancel" aria-label="close" type="button" onclick="this.closest('dialog').close()">âœ•</button>
      </header>
      <div class="modal-body" id="editorBody">
        <!-- JSã§ãƒ–ãƒ­ãƒƒã‚¯åˆ¥ãƒ•ã‚©ãƒ¼ãƒ ã‚’ç”Ÿæˆ -->
      </div>
      <footer class="modal-foot">
        <button class="ghost" value="cancel" type="button" onclick="this.closest('dialog').close()">Cancel</button>
        <button id="btnSaveBlock" class="accent" value="default">Save</button>
      </footer>
    </form>
  </dialog>

  <!-- YAMLãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <dialog id="yamlModal" class="modal glass">
    <form method="dialog" id="yamlForm">
      <header class="modal-head">
        <h3>YAML Preview</h3>
        <button class="del icon-close" value="cancel" aria-label="close" type="button" onclick="this.closest('dialog').close()">âœ•</button>
      </header>
      <div class="modal-body">
        <textarea id="yamlPreview" spellcheck="false" aria-label="YAML preview" style="width:100%; height:60vh;"></textarea>
      </div>
      <footer class="modal-foot">
        <button class="ghost" value="cancel" type="button" onclick="this.closest('dialog').close()">Close</button>
        <button id="btnYamlApply" class="accent" type="button">Apply</button>
      </footer>
    </form>
  </dialog>

  <!-- ãƒ¢ãƒ‡ãƒ«è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <dialog id="modelModal" class="modal glass">
    <form method="dialog" id="modelForm">
      <header class="modal-head">
        <h3 id="modelModalTitle">Model Settings</h3>
        <button class="del icon-close" value="cancel" aria-label="close" type="button" onclick="this.closest('dialog').close()">âœ•</button>
      </header>
      <div class="modal-body" id="modelModalBody">
        <!-- JSã§ãƒ¢ãƒ‡ãƒ«è¨­å®šãƒ•ã‚©ãƒ¼ãƒ ã‚’ç”Ÿæˆ -->
      </div>
      <footer class="modal-foot">
        <button class="ghost" value="cancel" type="button" onclick="this.closest('dialog').close()">Cancel</button>
        <button id="btnSaveModel" class="accent" value="default" type="button" onclick="this.closest('dialog').close()">Save</button>
      </footer>
    </form>
  </dialog>

  <!-- v2è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <dialog id="v2SettingsModal" class="modal glass" style="width: 90%; max-width: 1000px;">
    <form method="dialog" id="v2SettingsForm">
      <header class="modal-head">
        <h3>MABEL v2 è¨­å®š</h3>
        <button class="del icon-close" value="cancel" aria-label="close" type="button" onclick="this.closest('dialog').close()">âœ•</button>
      </header>
      <div class="modal-body" id="v2SettingsBody" style="max-height: 70vh; overflow-y: auto;">
        <!-- JSã§è¨­å®šãƒ•ã‚©ãƒ¼ãƒ ã‚’ç”Ÿæˆ -->
      </div>
      <footer class="modal-foot">
        <button class="ghost" value="cancel" type="button" onclick="this.closest('dialog').close()">Cancel</button>
        <button id="btnSaveV2Settings" class="accent" value="default">Save</button>
      </footer>
    </form>
  </dialog>

  <script src="{{ url_for('static', filename='js/app.core.js') }}"></script>
  <script src="{{ url_for('static', filename='js/app.graph.js') }}"></script>
  <script src="{{ url_for('static', filename='js/app.yaml.js') }}"></script>
  <script src="{{ url_for('static', filename='js/app.ui.models.js') }}"></script>
  <script src="{{ url_for('static', filename='js/app.ui.nodes.js') }}"></script>
  <script src="{{ url_for('static', filename='js/app.ui.editor.js') }}"></script>
  <script src="{{ url_for('static', filename='js/app.ui.v2settings.js') }}"></script>
  <script src="{{ url_for('static', filename='js/app.ui.init.js') }}"></script>
</body>
</html>
